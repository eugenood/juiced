<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
  </head>
  <body onload="draw();">
    <canvas id="canvas" width="300" height="300"></canvas>
    <script>
        function draw(grid) {
            var canvas = document.getElementById('canvas');
            var colors = [0, '#E0A369', '#555555', '#8600C8', '#FFCC22']
            if (canvas.getContext) {
                var ctx = canvas.getContext('2d');
                console.log(grid)
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                for (var i = 0; i < grid.length; i++) {
                    for (var j = 0; j < grid[i].length; j++) {
                        ctx.strokeRect(50 * j + 5, 50 * i + 5, 50, 50);
                        if (grid[i][j] != 0) {
                            ctx.fillStyle = colors[grid[i][j]];
                            ctx.fillRect(50 * j + 10, 50 * i + 10, 40, 40)
                        }
                    }
                }
            }
        }

        window.addEventListener('keydown', updateGrid, false);

        function updateGrid(e) {
            var action = 0;
            if (e.keyCode == 37) { action = 2; }
            if (e.keyCode == 38) { action = 0; }
            if (e.keyCode == 39) { action = 3; }
            if (e.keyCode == 40) { action = 1; }

            const Http = new XMLHttpRequest();
            const url = 'http://127.0.0.1/move/' + action;
            Http.open("GET", url);
            Http.send();

            Http.onreadystatechange = function(e) {
                var grid = eval(Http.responseText);
                draw(grid)
            }
        }

        const Http = new XMLHttpRequest();
        const url = 'http://127.0.0.1/start';
        Http.open("GET", url);
        Http.send();

        Http.onreadystatechange = function(e) {
            var grid = eval(Http.responseText);
            draw(grid)
        }
    </script>
  </body>
</html>
